<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Verification - Camera Lyst</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #1e1e1e;
            color: #e0e0e0;
            padding: 40px;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #252525;
            padding: 30px;
            border-radius: 12px;
        }
        h1 {
            color: #d32f2f;
            margin-bottom: 30px;
        }
        h2 {
            color: #fff;
            margin-top: 30px;
            padding-bottom: 10px;
            border-bottom: 2px solid #444;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #d32f2f;
        }
        .stat-label {
            color: #999;
            margin-top: 5px;
        }
        .file-list {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .file-item {
            padding: 10px;
            margin: 5px 0;
            background: #1a1a1a;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .file-item.success {
            border-left: 4px solid #4caf50;
        }
        .file-item.error {
            border-left: 4px solid #f44336;
        }
        .status {
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 0.85em;
            font-weight: 600;
        }
        .status.success {
            background: #4caf50;
            color: white;
        }
        .status.error {
            background: #f44336;
            color: white;
        }
        .manufacturer-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        .manufacturer-item {
            background: #2a2a2a;
            padding: 10px 15px;
            border-radius: 6px;
            border-left: 3px solid #d32f2f;
        }
        .btn {
            background: #d32f2f;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            margin: 10px 10px 10px 0;
        }
        .btn:hover {
            background: #b71c1c;
        }
        .sample-lenses {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .lens-sample {
            background: #1a1a1a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 3px solid #d32f2f;
        }
        .lens-sample strong {
            color: #d32f2f;
        }
        pre {
            background: #1a1a1a;
            padding: 15px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Camera Lyst - Data Verification</h1>
        <p>This tool verifies that all data from your Google Sheets CSV files has been loaded correctly.</p>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-number" id="totalLenses">Loading...</div>
                <div class="stat-label">Total Lenses Loaded</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalFiles">0</div>
                <div class="stat-label">CSV Files Processed</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalManufacturers">0</div>
                <div class="stat-label">Unique Manufacturers</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalCategories">0</div>
                <div class="stat-label">Categories</div>
            </div>
        </div>

        <button class="btn" onclick="runVerification()">Run Full Verification</button>
        <button class="btn" onclick="exportReport()">Export Report</button>

        <h2>File Loading Status</h2>
        <div class="file-list" id="fileStatus">
            <p style="color: #666;">Click "Run Full Verification" to check file loading status</p>
        </div>

        <h2>Category Breakdown</h2>
        <div id="categoryBreakdown"></div>

        <h2>Manufacturers</h2>
        <div class="manufacturer-list" id="manufacturerList"></div>

        <h2>Sample Lenses (First 10)</h2>
        <div class="sample-lenses" id="sampleLenses"></div>

        <h2>Data Integrity Checks</h2>
        <div id="integrityChecks"></div>
    </div>

    <script src="app.js"></script>
    <script>
        function runVerification() {
            // Update stats
            document.getElementById('totalLenses').textContent = allLenses.length;
            document.getElementById('totalFiles').textContent = csvFiles.length;
            document.getElementById('totalManufacturers').textContent = manufacturers.size;

            // Count unique categories
            const categories = new Set(allLenses.map(l => l.category));
            document.getElementById('totalCategories').textContent = categories.size;

            // Show file loading status
            const fileStatusHtml = csvFiles.map(file => {
                const lensesFromFile = allLenses.filter(l => l.category === file.category);
                const status = lensesFromFile.length > 0 ? 'success' : 'error';
                return `
                    <div class="file-item ${status}">
                        <span>${file.file}</span>
                        <span class="status ${status}">${lensesFromFile.length} lenses loaded</span>
                    </div>
                `;
            }).join('');
            document.getElementById('fileStatus').innerHTML = fileStatusHtml;

            // Category breakdown
            const categoryStats = {};
            allLenses.forEach(lens => {
                categoryStats[lens.category] = (categoryStats[lens.category] || 0) + 1;
            });

            const categoryHtml = `
                <div class="file-list">
                    ${Object.entries(categoryStats).map(([cat, count]) => `
                        <div class="file-item success">
                            <span>${cat}</span>
                            <span class="status success">${count} lenses</span>
                        </div>
                    `).join('')}
                </div>
            `;
            document.getElementById('categoryBreakdown').innerHTML = categoryHtml;

            // Show manufacturers
            const manufacturerHtml = Array.from(manufacturers).sort().map(mfr =>
                `<div class="manufacturer-item">${mfr} (${allLenses.filter(l => l.manufacturer === mfr).length})</div>`
            ).join('');
            document.getElementById('manufacturerList').innerHTML = manufacturerHtml;

            // Show sample lenses
            const sampleHtml = allLenses.slice(0, 10).map(lens => `
                <div class="lens-sample">
                    <strong>${lens.manufacturer}</strong> ${lens.name} ${lens['focal length']}<br>
                    <small style="color: #888;">
                        Category: ${lens.category} |
                        Aperture: T${lens['max aperture (T)'] || 'N/A'} |
                        Mount: ${lens['original mount'] || 'N/A'}
                    </small>
                </div>
            `).join('');
            document.getElementById('sampleLenses').innerHTML = sampleHtml;

            // Data integrity checks
            const missingManufacturer = allLenses.filter(l => !l.manufacturer).length;
            const missingName = allLenses.filter(l => !l.name).length;
            const missingFocal = allLenses.filter(l => !l['focal length']).length;
            const missingAperture = allLenses.filter(l => !l['max aperture (T)']).length;

            const integrityHtml = `
                <div class="file-list">
                    <div class="file-item ${missingManufacturer === 0 ? 'success' : 'error'}">
                        <span>Lenses with manufacturer</span>
                        <span class="status ${missingManufacturer === 0 ? 'success' : 'error'}">
                            ${allLenses.length - missingManufacturer} / ${allLenses.length}
                        </span>
                    </div>
                    <div class="file-item ${missingName === 0 ? 'success' : 'error'}">
                        <span>Lenses with name</span>
                        <span class="status ${missingName === 0 ? 'success' : 'error'}">
                            ${allLenses.length - missingName} / ${allLenses.length}
                        </span>
                    </div>
                    <div class="file-item ${missingFocal === 0 ? 'success' : 'error'}">
                        <span>Lenses with focal length</span>
                        <span class="status ${missingFocal === 0 ? 'success' : 'error'}">
                            ${allLenses.length - missingFocal} / ${allLenses.length}
                        </span>
                    </div>
                    <div class="file-item success">
                        <span>Lenses with aperture data</span>
                        <span class="status success">
                            ${allLenses.length - missingAperture} / ${allLenses.length}
                        </span>
                    </div>
                </div>
                <p style="color: #888; margin-top: 20px;">
                    Note: Some missing data is expected (e.g., aperture for certain specialty lenses)
                </p>
            `;
            document.getElementById('integrityChecks').innerHTML = integrityHtml;
        }

        function exportReport() {
            const report = `
Camera Lyst Data Verification Report
Generated: ${new Date().toLocaleString()}

SUMMARY
=======
Total Lenses: ${allLenses.length}
Total CSV Files: ${csvFiles.length}
Unique Manufacturers: ${manufacturers.size}
Categories: ${new Set(allLenses.map(l => l.category)).size}

CATEGORY BREAKDOWN
==================
${Array.from(new Set(allLenses.map(l => l.category)))
    .map(cat => `${cat}: ${allLenses.filter(l => l.category === cat).length} lenses`)
    .join('\n')}

MANUFACTURERS
=============
${Array.from(manufacturers).sort()
    .map(mfr => `${mfr}: ${allLenses.filter(l => l.manufacturer === mfr).length} lenses`)
    .join('\n')}

FILE LOADING STATUS
===================
${csvFiles.map(file => {
    const count = allLenses.filter(l => l.category === file.category).length;
    return `${file.file}: ${count} lenses`;
}).join('\n')}

DATA INTEGRITY
==============
Lenses with manufacturer: ${allLenses.filter(l => l.manufacturer).length} / ${allLenses.length}
Lenses with name: ${allLenses.filter(l => l.name).length} / ${allLenses.length}
Lenses with focal length: ${allLenses.filter(l => l['focal length']).length} / ${allLenses.length}
Lenses with aperture: ${allLenses.filter(l => l['max aperture (T)']).length} / ${allLenses.length}

SAMPLE LENSES (First 20)
=========================
${allLenses.slice(0, 20).map((lens, i) =>
    `${i + 1}. ${lens.manufacturer} ${lens.name} ${lens['focal length']} - T${lens['max aperture (T)'] || 'N/A'}`
).join('\n')}
            `;

            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'camera-lyst-verification-report.txt';
            a.click();
        }

        // Run verification on load
        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(runVerification, 1000);
        });
    </script>
</body>
</html>
